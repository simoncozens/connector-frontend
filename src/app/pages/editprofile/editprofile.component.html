<ion-header>
  <ion-navbar>
      <button ion-button menuToggle>
        <ion-icon name="menu"></ion-icon>
      </button>
      <ion-title>Edit Profile</ion-title>
      <ion-buttons end>
        <button ion-button *ngIf="dirty" (click)="save()" color="danger">
          Save changes
        </button>
      </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content>
<ion-item-group *ngIf="person">
  <ion-item>
    <ion-avatar item-start>
        <img width="80" height="80" item-left [src]="person.picture | fromBase64"/>
      </ion-avatar>
    <h3>{{person?.name}}</h3>
  </ion-item>
  <ion-item-divider color="primary">Basic information</ion-item-divider>
    <ion-item>
      <ion-label>Who can see my profile?</ion-label>
      <ion-select [(ngModel)]="person.field_permissions" multiple="true" (ionChange)="dirty = true">
        <ion-option>Everyone</ion-option>
        <ion-option>People at my events</ion-option>
        <ion-option>My Issue Networks</ion-option>
      </ion-select>
    </ion-item>
    <ion-item>
      <ion-label>Intro Bio
      </ion-label>
      <ion-textarea (ionChange)="dirty = true" [(ngModel)]="person.intro_bio"></ion-textarea>
    </ion-item>
    <ion-item-divider color="primary">Affiliations</ion-item-divider>
    <div *ngFor="let affiliation of person.affiliations; let idx = index; let last=last ">
        <ion-item-divider>
            <button ion-button color="danger"  item-end>
              <ion-icon name="trash" (click)="killAffiliation(idx)"></ion-icon>
            </button>
            <button ion-button item-end *ngIf="last">
              <ion-icon name="add" (click)="addAffiliation()"></ion-icon>
            </button>
            Affiliation {{1+idx}}
        </ion-item-divider>
      <ion-item>
        <ion-label floating>Organisation</ion-label>
        <ion-input (ionChange)="dirty = true" [(ngModel)]="affiliation.organisation"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label floating>Position</ion-label>
        <ion-input (ionChange)="dirty = true" [(ngModel)]="affiliation.position"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label floating>Website</ion-label>
        <ion-input (ionChange)="dirty = true" [(ngModel)]="affiliation.website"></ion-input>
      </ion-item>
    </div>
    <ion-item-divider color="primary">Personal Information</ion-item-divider>
      <ion-item>
      <ion-label>Country of Residence</ion-label>
          <ion-select [(ngModel)]="person.country" (ionChange)="dirty = true">
            <ion-option *ngFor="let country of picklists.countries">{{country}}</ion-option>
          </ion-select>
      </ion-item>
      <ion-item>
      <ion-label>Country of Citizenship</ion-label>
          <ion-select [(ngModel)]="person.citizenship" (ionChange)="dirty = true">
            <ion-option *ngFor="let country of picklists.countries">{{country}}</ion-option>
          </ion-select>
      </ion-item>
      <ion-item>
        <ion-label>Gender</ion-label>
        <ion-select [(ngModel)]="person.gender" (ionChange)="dirty = true">
          <ion-option value="Male">Male</ion-option>
          <ion-option value="Female">Female</ion-option>
        </ion-select>
        </ion-item>
        <ion-item>
          <ion-label>Primary language</ion-label>
          <ion-select [(ngModel)]="person.primary_language" (ionChange)="dirty = true">
            <ion-option value="English">English</ion-option>
            <ion-option value="French">French</ion-option>
            <ion-option value="Spanish">Spanish</ion-option>
            <ion-option value="Portuguese">Portuguese</ion-option>
            <ion-option value="Russian">Russian</ion-option>
            <ion-option value="Korean">Korean</ion-option>
            <ion-option value="Chinese">Chinese</ion-option>  
          </ion-select>
          </ion-item>
        <ion-item>
          <ion-label floating>Other languages</ion-label>
          <ion-input (ionChange)="dirty = true" [(ngModel)]="person.other_languages"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Comfort level with English</ion-label>
          <ion-select [(ngModel)]="person.comfort_level_with_english" (ionChange)="dirty = true">
            <ion-option value="None">None</ion-option>
            <ion-option value="Spoken">Spoken</ion-option>
            <ion-option value="Written">Written</ion-option>
            <ion-option value="Spoken & Written">Spoken & Written</ion-option>
            <ion-option value="Native Fluency">Native Fluency</ion-option>
          </ion-select>
          </ion-item>
        <ion-item>
            <ion-label>Issues of experience</ion-label>
            <ion-select [(ngModel)]="person.experience" (ionChange)="dirty = true" multiple="true">
              <ion-option *ngFor="let issue of picklists.issues" [selected]="person.experience">{{issue}}</ion-option>
            </ion-select>
          </ion-item>
        <ion-item>
          <ion-label>Regions</ion-label>
          <ion-select [(ngModel)]="person.regions" (ionChange)="dirty = true" multiple="true">
            <ion-option>Africa - French Speaking</ion-option>
            <ion-option>Caribbean</ion-option>
            <ion-option>East Asia</ion-option>
            <ion-option>Eurasia</ion-option>
            <ion-option>Europe</ion-option>
            <ion-option>Latin America</ion-option>
            <ion-option>Middle East / North Africa</ion-option>
            <ion-option>North America</ion-option>
            <ion-option>South Asia</ion-option>
            <ion-option>South Pacific</ion-option>
            <ion-option>Southeast Asia</ion-option>
          </ion-select>
        </ion-item>
</ion-item-group>
</ion-content>
